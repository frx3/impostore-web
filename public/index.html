<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Impostore - Web Game</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="container">
    <h1>üé≠ Impostore</h1>

    <!-- Menu Create/Join -->
    <section id="menuCard" class="card">
      <input id="nickname" placeholder="Nickname"/>
      <input id="roomInput" placeholder="Codice stanza (ABCD)" maxlength="4"/>
      <div class="buttons">
        <button id="createBtn">Crea Partita</button>
        <button id="joinBtn">Entra</button>
      </div>
    </section>

    <!-- Lobby -->
    <section id="lobbyCard" class="card hidden">
      <h2 id="roomCode">Codice: -</h2>
      <ul id="playerList"></ul>
      <button id="startBtn">Inizia</button>
    </section>

    <!-- Round View -->
    <section id="roundCard" class="card hidden">
      <h2 id="roleDisplay"></h2>
      <p id="wordDisplay"></p>
      <button id="nextBtn" class="next hidden">Prossimo Round</button>
    </section>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const nickname = document.getElementById('nickname');
    const roomInput = document.getElementById('roomInput');
    const createBtn = document.getElementById('createBtn');
    const joinBtn = document.getElementById('joinBtn');
    const startBtn = document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');
    const menu = document.getElementById('menuCard');
    const lobby = document.getElementById('lobbyCard');
    const round = document.getElementById('roundCard');
    const roomCode = document.getElementById('roomCode');
    const playerList = document.getElementById('playerList');
    const roleDisplay = document.getElementById('roleDisplay');
    const wordDisplay = document.getElementById('wordDisplay');
    let code = '';

    createBtn.onclick = () => {
      if (!nickname.value.trim()) return alert('Inserisci un nickname');
      socket.emit('create');
      socket.once('created', c => {
        code = c;
        roomCode.textContent = 'Codice: ' + c;
        socket.emit('join', { code: c, name: nickname.value.trim() });
      });
    };

    joinBtn.onclick = () => {
      if (!nickname.value.trim() || !roomInput.value.trim())
        return alert('Nickname e codice obbligatori');
      code = roomInput.value.trim().toUpperCase();
      socket.emit('join', { code, name: nickname.value.trim() });
    };

    socket.on('lobby', players => {
      menu.classList.add('hidden');
      lobby.classList.remove('hidden');
      roomCode.textContent = 'Codice: ' + code;
      playerList.innerHTML = '';
      players.forEach(p => {
        const li = document.createElement('li');
        li.textContent = p.name;
        playerList.appendChild(li);
      });
    });

    startBtn.onclick = () => socket.emit('start', code);
    nextBtn.onclick = () => {
      socket.emit('nextRound', code);
      nextBtn.classList.add('hidden');
    };

    socket.on('role', ({ impostor, word }) => {
      lobby.classList.add('hidden');
      round.classList.remove('hidden');
      nextBtn.classList.remove('hidden');
      roleDisplay.textContent = impostor ? 'üíÄ IMPOSTORE' : 'üîç INVESTIGATORE';
      wordDisplay.textContent = impostor ? '' : 'Parola: ' + word;
    });

    socket.on('error', alert);
  </script>
</body>
</html>